<section class="admin-panel">


  <div class="panel-view">
    <header class="panel-hero card" id="top" *ngIf="isSection('resumo')">
      <div class="hero-text">
        <p class="eyebrow">{{ saudacao }}, {{ primeiroNome }}!</p>
        <h1>Secretaria Escolar do SIGE</h1>
        <p class="lead">Acompanhe matrículas, transferências e solicitações oficiais em um só lugar.</p>
        <div class="hero-tags">
          <span class="tag">Último acesso: {{ ultimoAcesso }}</span>
          <span class="tag success">Atendimentos hoje: {{ estatisticas.solicitacoesHoje }}</span>
        </div>
      </div>
    </header>

    <section class="panel-section card" id="indicadores-section" *ngIf="isSection('indicadores')">
      <header class="section-header">
        <div>
          <h2>Indicadores da secretaria</h2>
          <p>Resumo diário das demandas acadêmicas.</p>
        </div>
      </header>

      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-icon usuarios">
            <i class="fas fa-users"></i>
          </div>
          <div class="stat-info">
            <h3>{{ estatisticas.matriculasAtivas }}</h3>
            <p>Matrículas ativas</p>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon sessoes">
            <i class="fas fa-file-signature"></i>
          </div>
          <div class="stat-info">
            <h3>{{ estatisticas.documentosPendentes }}</h3>
            <p>Documentos pendentes</p>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon sistema">
            <i class="fas fa-calendar-check"></i>
          </div>
          <div class="stat-info">
            <h3>{{ estatisticas.solicitacoesHoje }}</h3>
            <p>Solicitações do dia</p>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon dados">
            <i class="fas fa-route"></i>
          </div>
          <div class="stat-info">
            <h3>{{ estatisticas.transferenciasEmCurso }}</h3>
            <p>Transferências em curso</p>
          </div>
        </div>
      </div>
    </section>

    <section class="panel-section card" id="acoes-section" *ngIf="isSection('acoes') && quickActions.length">
      <header class="section-header">
        <div>
          <h2>Atendimentos rápidos</h2>
          <p>Fluxos ágeis para as rotinas da secretaria.</p>
        </div>
      </header>
      <div class="action-grid">
        <button class="action-card" *ngFor="let action of quickActions" (click)="executarAcao(action)">
          <i [class]="action.icon"></i>
          <div>
            <strong>{{ action.label }}</strong>
            <p>{{ action.description }}</p>
          </div>
        </button>
      </div>
    </section>

    <app-painel-pre-matricula
      [visible]="isSection('preMatriculas')"
      [preMatriculas]="preMatriculas"
      [statusLabels]="statusLabels"
      [statusClasses]="statusClasses"
      [filtro]="filtroPreMatricula"
      [selecionada]="preMatriculaSelecionada"
      (filtroChange)="filtroPreMatricula = $event"
      (selecionar)="selecionarPreMatricula($event)"
      (statusChange)="atualizarStatus($event)"
      (documentoChange)="atualizarDocumento($event.documento, $event.status)"
      (observacoesChange)="atualizarObservacoes($event)"
      (concluir)="concluirMatricula()"
      (indeferir)="atualizarStatus('indeferido')"
    ></app-painel-pre-matricula>

    <app-painel-transferencias
      [visible]="isSection('transferencias')"
      [solicitacoes]="solicitacoesTransferencia"
      [destinos]="destinosTransferencia"
      [historico]="historicoTransferencias"
      [selecionada]="transferenciaSelecionada"
      [statusLabels]="transferenciaStatusLabels"
      [statusClasses]="transferenciaStatusClasses"
      (selecionar)="selecionarTransferencia($event)"
      (destinoChange)="atualizarDestinoTransferencia($event)"
      (justificativaChange)="atualizarJustificativaTransferencia($event)"
      (confirmar)="confirmarTransferencia()"
      (cancelar)="cancelarTransferencia()"
    ></app-painel-transferencias>

    <app-painel-gestao-turmas
      [visible]="isSection('turmas')"
      [turmas]="turmasSecretaria"
      [professores]="professoresDisponiveis"
      [alunosDisponiveis]="alunosDisponiveisTurma"
      [selecionada]="turmaSecretariaSelecionada"
      (selecionarTurma)="selecionarTurmaSecretaria($event)"
      (criarTurma)="criarTurmaSecretaria($event)"
    ></app-painel-gestao-turmas>

    <app-painel-avisos-materiais
      [visible]="isSection('avisos')"
      [avisos]="avisosMateriais"
      [turmasDestino]="turmasSecretaria"
      [alunosDestino]="alunosDisponiveisTurma"
      (salvarAviso)="salvarAvisoMaterial($event)"
    ></app-painel-avisos-materiais>

    <app-painel-lancamento-professor
      [visible]="isSection('academicoProfessor')"
      [disciplinas]="lancamentoProfessorDisciplinas"
      [disciplinaSelecionada]="disciplinaLancamentoSelecionada"
      [turmaSelecionada]="turmaLancamentoSelecionada"
      [frequenciaOptions]="frequenciaOptions"
      (disciplinaChange)="selecionarDisciplinaLancamento($event)"
      (turmaChange)="selecionarTurmaLancamento($event)"
      (notaChange)="atualizarNotaLancamento($event)"
      (frequenciaChange)="atualizarFrequenciaLancamento($event)"
    ></app-painel-lancamento-professor>

    <app-painel-lancamento-alunos
      [visible]="isSection('academicoAlunos')"
      [alunos]="academicoAlunos"
      [selecionado]="alunoAcademicoSelecionado"
      (selecionarAluno)="selecionarAlunoAcademico($event)"
    ></app-painel-lancamento-alunos>

    <app-painel-dados-academicos
      [visible]="isSection('dadosAcademicos')"
      [alunos]="dadosAcademicosAlunos"
      [selecionado]="alunoDadosSelecionado"
      (selecionarAluno)="selecionarAlunoDados($event)"
    ></app-painel-dados-academicos>

    <app-painel-eventos
      [visible]="isSection('eventos')"
      [eventos]="eventos"
      [categorias]="categoriasEventos"
      [icones]="opcoesIconesEventos"
      (salvar)="handleSalvarEvento($event)"
      (remover)="handleRemoverEvento($event)"
    ></app-painel-eventos>

    <section class="panel-section card" id="usuarios-section" *ngIf="isSection('cadastros')">
      <header class="section-header">
        <div>
          <h2>Cadastros e perfis</h2>
          <p>Atualize vínculos de alunos, responsáveis e colaboradores.</p>
        </div>
        <button class="btn-primary" (click)="novoUsuario()">
          <i class="fas fa-plus"></i>
          Novo cadastro
        </button>
      </header>

      <div class="filters">
        <input type="search" placeholder="Buscar por nome ou email" [(ngModel)]="filtroUsuarios">
        <select [(ngModel)]="filtroTipo">
          <option value="">Todos os perfis</option>
          <option value="admin">Administrador</option>
          <option value="diretor">Diretor</option>
          <option value="professor">Professor</option>
          <option value="aluno">Aluno</option>
          <option value="responsavel">Responsável</option>
        </select>
      </div>

      <div class="users-table" *ngIf="usuariosFiltrados.length; else usuariosVazio">
        <table>
          <thead>
            <tr>
              <th>Nome</th>
              <th>Email</th>
              <th>Tipo</th>
              <th>Status</th>
              <th>Último acesso</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let usuario of usuariosFiltrados">
              <td>
                <div class="user-info-cell">
                  <div class="user-avatar-small">{{ usuario.nome.charAt(0) }}</div>
                  {{ usuario.nome }}
                </div>
              </td>
              <td>{{ usuario.email }}</td>
              <td>
                <span class="user-type-badge" [ngClass]="usuario.tipo">
                  {{ (usuario.tipo || 'N/A') | titlecase }}
                </span>
              </td>
              <td>
                <span class="status-badge" [ngClass]="usuario.status">
                  {{ usuario.status | titlecase }}
                </span>
              </td>
              <td>{{ usuario.ultimoAcesso | date:'dd/MM/yyyy HH:mm' }}</td>
              <td>
                <div class="table-actions">
                  <button class="btn-action edit" (click)="editarUsuario(usuario)" title="Editar">
                    <i class="fas fa-edit"></i>
                  </button>
                  <button class="btn-action delete" (click)="confirmarExclusao(usuario)" title="Excluir">
                    <i class="fas fa-trash"></i>
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <ng-template #usuariosVazio>
        <div class="empty-state">
          <i class="fas fa-user-slash"></i>
          <p>Nenhum usuário corresponde ao filtro aplicado.</p>
        </div>
      </ng-template>
    </section>
  </div>

  <footer class="panel-footer">
    <div class="user-info" *ngIf="usuario">
      <span>{{ usuario.nome }}</span>
      <button class="link-button" (click)="logout()">
        <i class="fas fa-sign-out-alt"></i>
        Encerrar sessão
      </button>
    </div>
  </footer>
</section>
